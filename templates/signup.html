<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cybernetic Signup</title>
  <link rel="icon" href="{{ url_for('static', filename='assets/logo.png') }}">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: radial-gradient(circle at center, #000814, #000);
      overflow: hidden;
    }
    .circuit-bg {
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(90deg, rgba(59,130,246,0.05) 1px, transparent 1px),
        linear-gradient(rgba(59,130,246,0.05) 1px, transparent 1px);
      background-size: 40px 40px;
      animation: pulse 8s ease-in-out infinite alternate;
      z-index: 0;
    }
    .matrix-stream {
      position: absolute;
      width: 2px;
      height: 120px;
      background: linear-gradient(to bottom, rgba(59,130,246,0.8), transparent);
      top: -150px;
      animation: fall 4s linear infinite;
      opacity: 0.5;
    }
    @keyframes pulse {
      0% { opacity: 0.2; }
      100% { opacity: 0.6; }
    }
    @keyframes fall {
      0% { transform: translateY(0); }
      100% { transform: translateY(120vh); }
    }
    .neon {
      text-shadow: 0 0 8px rgba(59,130,246,0.9), 0 0 24px rgba(59,130,246,0.6);
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center bg-black relative text-white font-sans">
  <div class="circuit-bg"></div>
  <script>
    for(let i=0; i<30; i++) {
      const line = document.createElement('div');
      line.classList.add('matrix-stream');
      line.style.left = `${Math.random()*100}%`;
      line.style.animationDelay = `${Math.random()*4}s`;
      line.style.animationDuration = `${3+Math.random()*4}s`;
      document.body.appendChild(line);
    }
  </script>

  <main class="w-full max-w-md mx-6 p-8 rounded-2xl shadow-2xl bg-gradient-to-br from-black/70 via-slate-900/60 to-slate-800/40 border border-slate-700/40 backdrop-blur-sm relative z-10">
    <header class="mb-6 text-center">
      <h1 class="text-3xl font-extrabold neon">CREATE ACCOUNT</h1>
      <p class="mt-2 text-sm text-slate-300">Join the neural mesh</p>
    </header>

    <form method="POST" action="{{ url_for('signup') }}" id="signupForm" class="space-y-5">
      <div>
        <label for="username" class="block text-xs text-slate-300 mb-2">Username</label>
        <input id="username" name="username" type="text" required placeholder="Your username"
          class="w-full px-4 py-3 rounded-xl bg-slate-900/50 border border-slate-700/40 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent placeholder-slate-500 transition" />
      </div>

      <div>
        <label for="email" class="block text-xs text-slate-300 mb-2">Email</label>
        <input id="email" name="email" type="email" required placeholder="you@domain.com"
          class="w-full px-4 py-3 rounded-xl bg-slate-900/50 border border-slate-700/40 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent placeholder-slate-500 transition" />
      </div>

      <div>
        <label for="password" class="block text-xs text-slate-300 mb-2">Password</label>
        <input id="password" name="password" type="password" required placeholder="Enter password"
          class="w-full px-4 py-3 rounded-xl bg-slate-900/50 border border-slate-700/40 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent placeholder-slate-500 transition" />
      </div>

      <div>
        <label for="confirm" class="block text-xs text-slate-300 mb-2">Confirm Password</label>
        <input id="confirm" name="confirm" type="password" required placeholder="Confirm password"
          class="w-full px-4 py-3 rounded-xl bg-slate-900/50 border border-slate-700/40 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent placeholder-slate-500 transition" />
      </div>

      <button type="submit" class="w-full py-3 rounded-xl bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-500 hover:to-cyan-400 active:scale-[0.997] transform transition shadow-lg shadow-cyan-900/30 ring-1 ring-blue-400/20">
        <div class="flex items-center justify-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          <span class="font-semibold">Sign Up</span>
        </div>
      </button>
    </form>

    <footer class="mt-6 text-center text-xs text-slate-500">
      <span>Already have an account?</span>
      <a href="/" class="ml-2 text-blue-300 hover:underline">Sign in</a>
    </footer>
  </main>

  <script>
    const form = document.getElementById('signupForm');

    // Floating message
    const msgBox = document.createElement('div');
    msgBox.className = "fixed top-6 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg text-sm text-white opacity-0 transition-all duration-700 ease-in-out shadow-xl";
    document.body.appendChild(msgBox);

    function showMessage(text, type) {
      msgBox.textContent = text;
      msgBox.classList.remove('bg-blue-500', 'bg-red-500');
      msgBox.classList.add(type === 'success' ? 'bg-blue-500' : 'bg-red-500');
      msgBox.style.opacity = "1";
      msgBox.style.transform = "translate(-50%, 0)";
      setTimeout(() => {
        msgBox.style.opacity = "0";
        msgBox.style.transform = "translate(-50%, -20px)";
      }, 2500);
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = form.querySelector('button[type="submit"]');
      btn.disabled = true;
      btn.classList.add('opacity-70');
      btn.innerHTML = '<span class="font-semibold">Creating...</span>';

      const password = document.getElementById('password').value.trim();
      const confirm = document.getElementById('confirm').value.trim();
      if (password !== confirm) {
        showMessage('Passwords do not match.', 'error');
        btn.disabled = false;
        btn.classList.remove('opacity-70');
        btn.innerHTML = '<span class="font-semibold">Sign Up</span>';
        return;
      }

      const formData = new FormData(form);

      try {
        const res = await fetch('/signup', {
          method: 'POST',
          body: formData
        });

        const data = await res.json();
        if (data.status === 'success') {
          showMessage('✅ Account created successfully!', 'success');
          setTimeout(() => window.location.href = '/', 1500);
        } else {
          showMessage(`❌ ${data.message || 'Error creating account'}`, 'error');
        }
      } catch (err) {
        console.error(err);
        showMessage('⚠️ Server error. Try again later.', 'error');
      } finally {
        btn.disabled = false;
        btn.classList.remove('opacity-70');
        btn.innerHTML = '<span class="font-semibold">Sign Up</span>';
      }
    });
  </script>
</body>
</html>